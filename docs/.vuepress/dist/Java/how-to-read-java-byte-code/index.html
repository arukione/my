<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>如何阅读 Java 字节码（Byte Code） | Kori Lin</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blog/hero.jpg">
    <meta name="description" content="Kori Lin - 林洁彬的个人博客">
    
    <link rel="preload" href="/blog/assets/css/0.styles.a7afc1cd.css" as="style"><link rel="preload" href="/blog/assets/js/app.a56c6be2.js" as="script"><link rel="preload" href="/blog/assets/js/2.c104596a.js" as="script"><link rel="preload" href="/blog/assets/js/4.955ca39c.js" as="script"><link rel="preload" href="/blog/assets/js/3.b9b417ac.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.ac48e4c7.js"><link rel="prefetch" href="/blog/assets/js/5.cffff764.js"><link rel="prefetch" href="/blog/assets/js/6.f4d6ee5b.js"><link rel="prefetch" href="/blog/assets/js/7.c3928ae3.js"><link rel="prefetch" href="/blog/assets/js/8.61c28d75.js"><link rel="prefetch" href="/blog/assets/js/9.4ab7970b.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.a7afc1cd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/hero.jpg" alt="Kori Lin" class="logo"> <span class="site-name can-hide">Kori Lin</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/archive/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="https://korilin.com/KUGshenzhen/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  深圳KUG
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/blog/archive/" class="nav-link">
  文章
</a></div><div class="nav-item"><a href="https://korilin.com/KUGshenzhen/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  深圳KUG
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <!----> </aside> <main class="page" data-v-53526f68> <div class="theme-default-content" data-v-53526f68><div class="getback" data-v-53526f68><a href="/blog/archive/" data-v-53526f68>
                   &lt; 返回
                </a></div> <div class="head" data-v-53526f68><div class="title" data-v-53526f68><h1 data-v-53526f68>如何阅读 Java 字节码（Byte Code）</h1></div> <div class="info" data-v-53526f68><span data-v-53526f68>2021年3月8日</span> <span style="margin-left: 20px" data-v-53526f68>Oh! Java</span></div></div> <div class="content__default" data-v-53526f68><h2 id="字节码-byte-code"><a href="#字节码-byte-code" class="header-anchor">#</a> 字节码（Byte Code）</h2> <p>学习 Java 的都知道，我们所编写的 <code>.java</code> 代码文件通过编译将会生成 <code>.class</code> 文件，最初的方式就是通过 JDK 的 <code>javac</code> 指令来编译，再通过 <code>java</code> 命令执行 main 方法所在的类，从而执行我们的 Java 程序。而在这中间所生成的 .class 文件中的内容，就是 JVM 可以处理运行的字节码（Byte Code），它由 JVM 解释为对应系统可运行的机器指令，这也是我们的 Java 程序能够做到一处编译处处执行的原理。</p> <p>对于 Java 开发人员来说，平时需要阅读 Byte Code 的场景比较少，但和阅读框架源码能够了解到框架的设计思路一样，阅读 Java Byte Code 也有利于我们理解 Java 一些深层的东西，提高我们解决问题的能力。能够阅读 Byte Code 也有利于我们去理解 Kotlin 或其它运行在 JVM 上的语言，是如何扩展 Java 所没有的特性或语法糖。</p> <h2 id="字节码文件结构"><a href="#字节码文件结构" class="header-anchor">#</a> 字节码文件结构</h2> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>首先我们先编写一个简单的 Java 代码作为演示例子，然后编译这个 Hello.java 文件得到 Hello.class 文件。我们知道 .class 是二进制文件，它无法被直接查看，当然我们可以通过一些二进制文件查看工具来阅读里面的内容。</p> <p><img src="/blog/assets/img/read-byte-code-in-vscode.5c1e9d3a.png" alt="（在 Visual Studio Code 里使用 hexdump for VSCode 插件查看到的内容）"></p> <p>一个符合标准的 <code>.class</code> 文件是以 <code>CA FE BA BE</code> 开头，这个四个字节均为魔数，JVM 根据这个开头来判断一个文件是否可能为 <code>.class</code> 文件，如果是才会继续执行。</p> <p>魔数后面四个字节  <code>00 00 00 34</code>  是版本号，前两个字节为次版本号，后两个字节为主版本号，在对主版本号进行转换可以得到 52，该序号对应的 Java 版本为 1.8。</p> <p>如果需要查阅最新的 Java 版本对应的版本号，可以在官方查看 Java SE 最新版本的文档</p> <blockquote><p>Oracle Java SE Specifications：https://docs.oracle.com/javase/specs/index.html</p></blockquote> <p>在版本号后面则是常量池，它包含常量池计数器（constant_pool_count）和常量池数据区两个部分。前面两个字节 00 28 是计数器，用于表示常量池的容量计数值，代表常量池数据区有 <code>constant_pool_count - 1</code> 个常量。</p> <p><img src="/blog/assets/img/constant-pool-structure.51f6a726.png" alt="常量池结构"></p> <p>在常量池后面还有访问标志，很显然这个文件对于我们来说阅读起来并不方便，但是我们可以转换为助记符来帮助我们阅读。</p> <h3 id="使用-javap-命令"><a href="#使用-javap-命令" class="header-anchor">#</a> 使用 javap 命令</h3> <p>当我们拥有一个 <code>.class</code> 文件时，我们可以通过 <code>javap</code> 来将字节码指令转换为助记符，这个命令有一些参数，你可以通过 <code>javap -help</code> 来查看所有参数的说明，这里为了显示尽量详细的内容，使用 <code>javap -verbose Hello</code>，其效果如下，但由于内容太长，我们不一次性展示所有内容，而是分区域来进行阅读。</p> <div class="language- extra-class"><pre class="language-text"><code>Classfile /F:/project/java/JavaMain/out/production/JavaMain/Hello.class
  Last modified 2021-3-26; size 645 bytes
  MD5 checksum ca1b2193159aece89c05c7f9d3b54c7b
  Compiled from &quot;Hello.java&quot;
public class Hello
  minor version: 0
  major version: 52
  flags: ACC_PUBLIC, ACC_SUPER
</code></pre></div><p>最开始几行是关于这个文件的基本信息，之后是类的信息，我们的关注点从类这里开始。</p> <p>在类里面，它包含了主版本号（major version），次版本号（minor version），访问标志（flags）。</p> <p>对于版本号，和我们上面所讲的一样，因此这里不再重复。而 flags 是关于这个类的相关修饰符，根据官方文档，它可能拥有的值如下：</p> <p><img src="/blog/assets/img/class-decorator-flags.b61de109.png" alt=""></p> <h3 id="常量池"><a href="#常量池" class="header-anchor">#</a> 常量池</h3> <p>在类信息的下面，则是常量池，它类似一个表，每个常量由编号、类型、值，这 3 个部分组成。我们列出一小部分来了解它的结构。</p> <div class="language- extra-class"><pre class="language-text"><code>Constant pool:
   #1 = Methodref          #6.#26         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V
   #2 = Methodref          #5.#27         // Hello.add:(II)I
   #3 = Fieldref           #28.#29        // java/lang/System.out:Ljava/io/PrintStream;
   #4 = Methodref          #30.#31        // java/io/PrintStream.println:(I)V
   #5 = Class              #32            // Hello
   #6 = Class              #33            // java/lang/Object
   #7 = Utf8               &lt;init&gt;
   #8 = Utf8               ()V
   #9 = Utf8               Code
  #10 = Utf8               LineNumberTable
  #11 = Utf8               LocalVariableTable
  #12 = Utf8               this
  #13 = Utf8               LHello;
  #14 = Utf8               main
  #15 = Utf8               ([Ljava/lang/String;)V
</code></pre></div><p>在这里列出了前 15 个常量，每个常量都有一个编号，编号以符号 <code>#</code> 开头，编号后面是 <code>=</code> 加上该常量的类型，具体类型说明请参考官方 jvms 文档的 The Constant Pool 的解释。这里我们从中挑选几个常量来进行说明。</p> <p>由于我们使用的命令是 <code>javap -verbose</code> 因此它会给我们加上一些注释说明，我们可以看到 <code>#2</code> 常量后面的注释是 <code>Hello.add:(II)I</code>，那么我们可以猜测它应该是我们代码中所编写的 <code>add()</code> 方法，由于这个方法是静态，因此它被加入到这个类中的常量区。那么这个常量的值呢？</p> <p>对于 Methodref 类型，它的值是该方法的名称，对于一个方法而言，它的名称是一个字符串，因此构成方法名称的字符串也会被添加到常量池中，<code>#2</code> 这个方法，它的名称引用了常量池中其它的两个常量，也就是 <code>#5</code> 和 <code>#27</code>，而这两个常量以及与它们相关的其它常量在常量池中的值如下：</p> <div class="language- extra-class"><pre class="language-text"><code>   #2 = Methodref          #5.#27         // Hello.add:(II)I
   #5 = Class              #32            // Hello
  #22 = Utf8               add
  #23 = Utf8               (II)I
  #27 = NameAndType        #22:#23        // add:(II)I
  #32 = Utf8               Hello
</code></pre></div><p>在常量池中我们可以看到，<code>#5</code> 是一个类，它的值和方法一样都是名称，因此它引用了常量 #32，对于 <code>Utf8</code> 类型的常量，其值则是一个字符串，也就是常量 <code>#32</code> 的值就是字符串 <em>Hello</em>。因此 <code>#5</code> 的值就是 <em>Hello</em>。同样的 <code>#27</code> 的值是 <code>add:(II)I</code>，将它们组合起来 <code>#2</code> 的值就是 <code>Hello.add:(II)I</code> 了。</p> <h3 id="包含的方法"><a href="#包含的方法" class="header-anchor">#</a> 包含的方法</h3> <p>与 Java 代码一样，我们所定义的方法在类里面，而在字节码中我们定义在类中的方法也放在大括号里面，而这个大括号就在常量池下方。</p> <p>对于每个方法，都包含首行的声明，以及紧接在后面的 descriptor（描述符号），flags（访问标识），Code（代码），我们把 Code 部分的内容先省略，先看一下类中所拥有的所有方法。</p> <div class="language- extra-class"><pre class="language-text"><code>{
  public Hello();
    descriptor: ()V
    flags: ACC_PUBLIC
    Code:
      // 省略

  public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      // 省略

  public static int add(int, int);
    descriptor: (II)I
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      // 省略
}
</code></pre></div><p>可以看到，我们并没有给类写构造方法，但这里却生成了 <code>public Hello();</code>，这也说明了为什么我们在 Java 中不给类写构造方法，默认会有一个无参的构造方法。</p> <p>另外我们可以看到到 <code>add(int, int)</code> 方法的 descriptor 为 <code>(II)I</code>，这与我们上面观察常量池时 <code>Hello.add:(II)I</code>  冒号后面带的字符是一样的，这其实是这个方法的参数以及返回值的缩写。当我们在 Java 中编写重载方法时，由于方法名一样，JVM 可以通过 descriptor 来区分所调用的方法是哪一个。</p> <p>而 flags 与 Class 的 flags 类似，用于声明方法所拥有的修饰符。而最后的 Code 中包含的则是该方法的代码所执行的指令。</p> <h3 id="code-的结构"><a href="#code-的结构" class="header-anchor">#</a> Code 的结构</h3> <div class="language- extra-class"><pre class="language-text"><code>  public static void main(java.lang.String[]);
    descriptor: ([Ljava/lang/String;)V
    flags: ACC_PUBLIC, ACC_STATIC
    Code:
      stack=2, locals=4, args_size=1
         0: iconst_1
         1: istore_1
         2: iconst_1
         3: istore_2
         4: iload_1
         5: iload_2
         6: invokestatic  #2                  // Method add:(II)I
         9: istore_3
        10: getstatic     #3                  // Field java/lang/System.out:Ljava/io/PrintStream;
        13: iload_3
        14: invokevirtual #4                  // Method java/io/PrintStream.println:(I)V
        17: return
      LineNumberTable:
        line 3: 0
        line 4: 2
        line 5: 4
        line 6: 10
        line 7: 17
      LocalVariableTable:
        Start  Length  Slot  Name   Signature
            0      18     0  args   [Ljava/lang/String;
            2      16     1     a   I
            4      14     2     b   I
           10       8     3     c   I
</code></pre></div><p>以 main 方法为例子，在 Code 中可以分为 3 个部分，第一个部分是代码的指令表，该部分第一行是该方法的指令以及执行过程的相关信息，这一行信息包括：</p> <ul><li>args_size 是参数数量，在主函数中，因为有 args 这个参数，所以在这里 args_size 为 1；</li> <li>locals 是该方法中的本地变量有多少个，在我们的主函数里面有定义了 3 个变量，加上一个参数，因此有 4 个变量；</li> <li>stack 是方法在执行过程中，操作数栈中最大深度，这个在之后讲解指令执行过程时可以看出。</li></ul> <p>在这一行信息之后是字节码指令，一条指令包括偏移量以及执行的指令码，PC Register 利用偏移量来判断指令执行位置。</p> <p>第二部分是 LineNumberTable，它是一个代码行对照表，用于标识我们 Java 代码中对应的行数的代码在 Code 中从哪个位置开始。</p> <div class="language- extra-class"><pre class="language-text"><code>LineNumberTable:
  line 3: 0
  line 4: 2
  line 5: 4
  line 6: 10
  line 7: 17
</code></pre></div><p><code>line 3: 0</code> 代表 Java 源码文件中的第三行代码从偏移量为 0 的位置开始，而继续往下看可以看到第四行代码从偏移量为 2 的位置开始，也就是说第三行代码所对应的字节码指令有 <code>iconst_1</code> 和 <code>istore_1</code> 两条。这也可以让 JVM 执行指令出现错误时，帮助我们定位到对应的源码位置。</p> <p>第三部分为 LocalVariableTable，调试器可以使用它在方法执行的过程中确定局部变量的值，它是一个可选的属性，在程序执行的时候并不需要它。</p> <ul><li>第一个属性 start 为这个变量可见的起始偏移位置，它的值必须是在 Code 中存在的偏移量值。</li> <li>第二个属性 length 为该变量的有效长度，在这个例子中，我们的变量直到方法末尾都有效，因此你会发现 <code>start + lenth</code> 的值都是 18 （方法中执行的指令数）。当我们在一个局部的代码块里面声明一个变量，那么它的有效期长度将会更短。</li> <li>Slot 为变量在 local variable 中的位置，这可以帮助我们在指令中确定对应的变量，而 Name 则是变量名，Signature 为该变量的类型。</li></ul> <p>当我们初步了解了 Code 属性的格式后，我们就可以对其中的指令执行进行分析了，但在此之前，我们需要先有一点 JVM 内存布局的基础知识，这对于我们之后了解指令的执行过程非常重要。</p> <h2 id="jvm-内存结构"><a href="#jvm-内存结构" class="header-anchor">#</a> JVM 内存结构</h2> <p>我们的 Java 程序在运行时是通过 <code>main()</code> 方法启动，它是程序的入口，我们的进程在启动时会为该方法创建一个主线程来执行代码。当我们使用多线程时，那么程序的进程将会拥有多个线程。每个线程的资源都拥有独自的资源，当然它们也可以共享进程的资源，那么在 JVM 中，根据资源的可用范围，可将内存区域分为线程独占和线程共享两个类别。</p> <p><img src="/blog/assets/img/jvm-memory-layout.f1be9236.png" alt="JVM内存布局"></p> <p>对于每一个线程，都可将其拥有的内存空间分为 PC Register、Native Method Stack、JVM Stack 这 3 个区域，这 3 个区域对于线程来说都是独占的，其它线程无法进行访问。</p> <ul><li><strong>PC Register</strong> 用于记录当前线程指令的执行位置。由于一个进程可能有多个线程，而 CPU 会在不同线程之间切换，为了能够记录各个线程的当前执行的指令，每个线程都需要有一个 PC Register，来保证各个线程都可以进行独立运算。</li> <li><strong>JVM Stack</strong> 用于存放调用方法时压入栈的栈帧。相信学过数据结构的对栈应该不陌生，JVM Stack 压入的单位为栈帧（Frame），用于存储数据、动态链接、方法返回值和调度异常等。每次调用一个方法都会创建一个新的栈帧压入 JVM Stack 来存储该方法的信息，当该方法调用完成时，对应的栈帧也会跟着被销毁。一个栈帧都有自己的局部变量数组、操作数栈、对当前方法类的运行常量池的引用。</li> <li><strong>Native Method Stack</strong> 则是用于调用操作系统本地方法时使用的栈空间。</li></ul> <p><img src="jvm-stack.png" alt="JVM Stack 结构"></p> <p>每个线程都可用访问的内存空间为线程共享区域，它包含 Head 和 Method Area 两个部分，Head 用于存放实例对象，也是 GC 回收的主要区域，而 Method Area 用于存放类结构与静态变量。</p> <p>现在我们初步了解了 JVM 内存的布局，那么接下来可以继续看指令的执行过程了。</p> <h2 id="指令的执行过程"><a href="#指令的执行过程" class="header-anchor">#</a> 指令的执行过程</h2> <p>由于 Java 程序从 <code>main()</code> 方法开始，我们也是从这个方法的指令开始进行分析。</p> <p>假设程序运行 0 号指令前的状态如下，在 mian 方法栈帧里面，有着 operand stack（操作数栈），它的最大长度为 2（与 Code 下的 stack 的值一致），此外还有一个 local variable（本地变量表）来存放变量的值，其中下标为 0 的变量为主方法的参数 args，我们直接用这个字符串填充在那里来做一个标识（实际的值可能是一个空数组）。</p> <p><img src="/blog/assets/img/execute0.20b172e8.png" alt=""></p> <p>接下来我们一步步执行方法中的指令，在这里我们先对出现的几个指令做一个简单的介绍：</p> <ul><li><code>iconst_&lt;i&gt;</code> 放一个 int 常量（-1, 0, 1, 2, 3, 4 or 5) 到 operand stack 中</li> <li><code>istore_&lt;n&gt;</code> 从 operand stack 中获取一个 int 到 local variable 的 n 中</li> <li><code>iload_&lt;n&gt;</code>  从 local variable 中读取 int 变量 n 的值到操作数栈中</li> <li><code>invokestatic</code> 调用一个 class 的 static 方法</li> <li><code>getstatic</code> 从 class 中获取一个 static 字段</li> <li><code>invokevirtual</code> 调用一个实例方法，基于类的调度</li> <li><code>return</code> 从方法中返回一个 void，<code>ireturn</code> 从方法中返回 operand stack 栈顶的 int</li></ul> <p><em>更多的指令与详细的说明请查看文章最后参考中的官方指令文档</em></p> <p>现在我们开始分析指令的执行，我们在上面知道了，我们的 Java 代码所对应的指令分别是偏移量为 0 和 1 的两个，最开始执行的是 <code>0: iconst_1</code>，该指令会把 int 常量 1 放置到 operand stack 中，之后执行的是 <code>1: istore_1</code>，把 operand stack 栈顶的 int 常量取出放到 local variable 下标为 1 的变量中，该过程图示如下。</p> <p><img src="/blog/assets/img/execute1.bbf243b6.png" alt="iconst_1 与 istore_1 的执行过程"></p> <p>我们可以通过查看 LocalVariableTable 得知下标为 1 的变量在我们的 Java 程序中是 int 变量 a，因此上面这两条指令常量 1 赋值给变量 a。同样的，后面两条指令则是将常量 1 赋值给变量 b。这里要注意，操作数栈的数是被取出操作，被取出的数将不会继续在 operand stack 里面。</p> <p>执行完 0~3 这 4 条指令后，就来到了本例中最为关键的方法调用了。在执行 <code>iload_1</code> 和 <code>iload_2</code> 后，operand stack 中将会存放着变量 a 和 b 的值，作为 <code>invokestatic</code> 调用函数时传入的参数。</p> <p>而执行到 <code>invokestatic #2</code> 这个指令的时候，该指令为调用一个 class 的 static 方法，也就是调用常量池中 <code>#2</code> 的方法，该方法为 <code>Hello.add:(II)I</code>。</p> <p>当执行 invokestatic 时会依次读取 operand stack 的数据作为方法的参数，并创建一个新的栈帧来执行方法，将数据放到 local variable 对应变量位置。</p> <p><img src="/blog/assets/img/execute2.f6a2c7fa.png" alt=""></p> <p>之后开始执行 <code>add()</code> 方法中的指令，首先执行的是两个 <code>iload</code> 指令，将 loca variable 对应下标的变量的值放到 operand stack 中，之后执行 <code>iadd</code> 取出 operand stack 中的值并进行加法运算，再把结果放到，最后执行 ireturn 取出 operand stack 顶部的 int 值进行返回。</p> <p><img src="/blog/assets/img/execute3.bd1b6c0d.png" alt="执行了两个 iload 指令"></p> <p><img src="/blog/assets/img/execute4.15ed7036.png" alt="执行 iadd 指令"></p> <p><img src="/blog/assets/img/execute5.cc14c853.png" alt="ireturn 取出栈顶的 int 常量作为方法的返回值"></p> <p><img src="/blog/assets/img/execute6.c68236e4.png" alt="执行 istore_3"></p> <p>当执行完 <code>ireturn</code> 后，add 方法也就执行完成了，对应的栈帧也会跟着销毁。之后回到 main 方法中继续往下执行，到 <code>istore_3</code> 指令，该指令将栈顶的 int 值取出放到了 local variable 中 Solt 为 3 的地方，这样执行完 4~9 这几条指令后就完成了我们代码中的 <code>int c = add(a, b);</code> 这一行代码。那么接下来就是执行 <code>System.out.println(c);</code> 对应的指令将 2 打印到控制台了。</p> <p>到这里其实我们就已经知道如何去阅读我们代码生成的 Byte Code 了，这里我就不继续往下分析本文例子的代码了，阅读过程中如果遇到了没见过的指令，我们可以在 Oracle 官方指令文档里面查阅对应的说明。</p> <p>那可能有人会觉得，如果每次查看一个类都需要去 command line 执行 <code>javap</code> 来查看对应的助记符，这样非常麻烦呀。那么接下来我们讲一下如何在 IntelliJ IDEA 里面直接阅读 Byte Code。</p> <h2 id="在-intellij-idea-阅读"><a href="#在-intellij-idea-阅读" class="header-anchor">#</a> 在 IntelliJ IDEA 阅读</h2> <p>如果你希望在 IntelliJ IDEA 里阅读 Byte Code，那么可以按照 <strong>Bytecode Viewer</strong> 这一个插件，只需要在 Plugins 里面查找就能找到。</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZkAAADCCAYAAACbm79OAAAgAElEQVR4Ae1dXY8dR5nmv8yymbA4CVkSnC8HbJPYydjYiZPZBMjaGJtMwkg20a5mJYQcDIgJc4EjQ26CtLsyO2JWa4ldxAa4xNq5mD+QuzUyUvgJ2YuoVm9VP11v16nq0+d0V58+5zwXR9WnPt56662n3qc++uNTf3X/A4Y/2oAYIAaIAWIgBwY+lUMoZRKsxAAxQAwQA4IBkgxXclzJEgPEADGQDQMkGYIrG7g4k+VMlhggBkgyJBmSDDFADBAD2TBAkiG4soGLs1jOYokBYoAkQ5IhyRADxAAxkA0DJBmCKxu4OIvlLJYYIAZIMiQZkgwxQAwQA9kwQJIhuLKBi7NYzmKJAWKAJEOSIckQA8QAMZANAyQZgisbuDiL5SyWGCAGSDIkGZIMMUAMEAPZMECSIbiygYuzWM5iiQFigCRDkiHJEAPEADGQDQMkGYIrG7g4i+UslhggBkgyJBmSDDFADCwJBtbOnDPy65P8B0kyj61/ybx44xXz2q8umq/vXjCnfnjOPHT8sV4N02cnsC7O9ogBYiA3BtbOvGQ++eQT+5Pr3PVB/qBI5tOfedCc/tE5c/kPb4z8Lv1uwzz9zWd6MwwMxJCDnxggBhYBAySZ+x8wx6+sjZCLJpxLv98wnz/1FIlmDpb2K6tnzcbmFfdbOzvTPju5ecWcXD00Ux0WwUmxDfNPtku9XXbfgw+Zi//1rVqSEcI597NXB+0sTm7eMLt7tyO/G2Zjc7bOtk8nsbJ2w9y595H505//Yu7uXWnVZ5awdrxNt9fihCF1lrbfOWuk3PZ+ocO9A5Mq16ddWNf8O+p57sOlJhlZoehVS+r60gcb5tN/M1ygntw5sI5VnGvsd7elszu5dsVs7wx/Zt4lycig1na9sxMn6409Ryhi993NQ2Zl9YrZLYgOcfPsIKj7cMf9PPTN0m+XPfbK0UYkI+Rz/yMPt5oZ5wSEdoZ39zH7Pihn9eLs7u7fmHj7RjvMacrnbHNMdtckU5EXsV911XLbbBTbYytCyrKyTBBTTHfG0ZkvIgaWnmQen4hk/nYuSEbPuCtO8p53gk3BvPQkM2brq2LflttzTfuE+UhG84aBpd4uW3iSUVs3shI5cd8Zs71/YO4Uv/C8QFZESPvlb+TabwXJasilebLCuUV5DnLvwNzZG91Wk3wnN2/b8iLHrawOTIUQ5dB+R/L4Ou/uH5jdxDadWy34bcI7+3L+lD6TaaprOID1KlHrK/l0mmyVSZxd3ezBjt5WSLNtxLmRspfVT5dTZ0C6X1AP6i/7pMjfpJ0bqp7ttbMG/7nyIoEJrrr+LSTJfPaJR8wXv3XCrF17wZz+wYvJ30s//2rj7bKv/PilpByp47nvnjFPfv2YWf3c5zrvpHGdrp0dHOGKdR7+ABrOKZZX5FvniAPr/Rvme+qsAcRgyaFYEen8Ot0RiHeutfmK2b9dMSlyGZVX3erTK6wwL/7rg/9aHfa9rjE7V1YrastMy7yrVolN4qEjQtnilK023TfoLy1P8qN/RVecB2ErM8wL+RKijkq5ewdmd08RNbf3eh+7McwtUtxCbpcd+cYz5uJvX29MHqnD/mnjX/v3i+bhk0/0ClbtnLRjKZ2LmhUnnaa6M0scmRz2V1YG+7fNtr09+Kw924GDkzp2izvYtGw4Q51PHN32psiWlc0Nu0rRTs/pe8NsSLqcayjigbyR/Hs3SnlYUVk5avtK61Cna2xwa8etb6DQbU0RmiafJjpomWhvSKieUPwNBsjbpI7QfmKrOzjHW6I7EWN9zbgcq5gFexjz4WcfN/IA5bQE0VU5IZrVh/tb0dSRjHW4MmNVs1Q4I+00IUPHaQcH5yYDsRKvnHnFIdvtOe8ItcPVg7kiS60URuopV1BKZph/83Z5dx0cf0V+ja51z7TANmJLrDBicU5nfQuzW6E01eHEfaNtWynaJFuHri8LmcWkAP3VtA5pJ/rfEozChe4XXnfvcJfVpgu1XXbq+oszJxgQ1ZOvHe9tNaMd3h05w7ArgeIcJHI7LRwXnExIDnC4FcelHLqecYuTwzmOhCITzvD1539a3uEGpx8OtIosRQKSr6JXcRt2bX61GkN9lfw1uuLOsFA/q0cgt6pXdbstljaJDiAAkDL6dnfnRnlrtBAd+hD5pquDz/HE+ptx80+w2V4r83e/+PpgSObEP31lRiRTfZ4DTgqEYp2mvmtKyEM5UczUXb7RmbWNVysGkEoYivN7/dv/4UknIBAMZDhLS0xBnqrDdg6xNr9qR0kyDXWtJRltL7uiUnap1blYdUygA9rnVihuVaSv0Y/o12na6YmMJAMcMpx/YtF9mI1kvvqv5wdDMs99r+rstQG6vobDgQPS8lNpiBcy2N5x20yYFaN8o5VM4GRRVsLK7FqthJrmqdSP7bIIkUAeHLQmrIoONbpCRiqEvUS2POEvob0u7ipDuSoxVre2tF7IH4a6zXd23N1y2KqEDvIf51WYFEzSTpLMYjnUEEP8/4AhyXR8myCcjzixJttlAkLtlOAwMSsGSLXD0wRUdaSjs2E5tD+5Jk+/+/OJUjc8sCi3LK9VX8MieXAwLzrodkE3rZPOb29pVjcK+PxeB5xfoH22jkJXHRe7jtorQpy6zbBZNS5tL6lX58X2Iw72NYlK2yE/LDeunSQZkkwM44sUR5LJSDLifGI/OF0NJDgb5MesGHm0w0MeOLYRh1c8eyP5tJOTfPquL8iRsHSeanWi03GNOqGXJh/kCUPd3qa6Qn4qDO0F/XV+bTOt9yQ6hO1Dv4QEixUO6m9aB9qh+wkyGJKAFgEDJJkeScY+0Ji4NVU7pdBhAWjhDF47TvuApbqxAI5eZOkzDpGxq1YZyKeddDKP3KIceZuxPEAIORLa50BqHsZsqivaHQsr9kq8Dy5FMiKvqQ7a5treWra0WdsP+japgyRDIgFeFjUkyXRMMtMCRTvNmMPScuXhTnvXWsThl2ljXq8vThJ3vmnZ+rpJHp3fyYu/IVnnw3VTXZE/R9iHDn3UkcM2lEkC7AIDJJmBkAxntBzQXQxoyiCOhoYBkswMSeakvB9M3hCstq/GrWKGBiDqQ6dGDBADdRjIRjJPX37WfPk7a/b3zFunzJmfvGy+8evLM7mt+dQPzxl5h5r9PfZIb8/M1Ble0sJD5dRZzDg5TOcgJwaIgaFiIBvJxBp83wMPmWf/8bS5/Ps3ZkI2eAOAvO5GXsg56085l9862XPvCIvZjHF0HsQAMTDPGOiVZGCoL75+YqYkU5LN7zfM0998ZjArG9iHIZ0KMUAMLAoGZkIyYryX32v+an+QQo7w0u/eMA8df4xEM8OzqUUZTGwHiYEYGMXAzEjmia8dG8RqRohLzmwIjlFw0Ca0CTFADLTFwMxI5oEjjw6GZL72ywskGa5kiAFigBjIgIGZkYzc6ZVj+2sama/96iLBlQFcbWdALM9ZNDEw/xiYGck8evbIYEjmxZ++QpIhyRADxAAxkAEDMyOZUz84NxiSeWz9SwRXBnBxFjr/s1D2IfuwLQZmQjKfX3vKyF1d02xtdV3m9I946N8WRCxPR0QMEAMpDPROMo++8LS58J+zefJfE9TF33zLHL/6vPn0Zx7kKoarGGKAGCAGMmEgG8k8/Ozj5pHTT5U/ec3MuXdfmcnq5dzPXjVPnT9uf0++dtx8/vknzX0PPkRQZQJVakbDeM52iYHlw0A2klnWzy9zEC3fIGKfs8+JgTQGSDKczXNFRwwQA8RANgyQZAiubODi7C49u6NtaJtlwcDgSEbuOpPXvDx69mn7av5DTz1q5BU0bd519tz3ztKRkkyJAWKAGJgBBgZFMnLXmdzenGJ4+/bmKT4T0BfJrKweM+ffuWWuvtD8E8Spto6LX3nhmrn5zqY5vHrIrKyum6vvXzNrkc8xTyJnXF6mc/ZNDBADk2JgUCQjtzePa4D9Hs0fJnvGhiSTHhiarGK2l/Sf/eKX9nfz/XfN+SOeQB253WqQFifAw5ffLWWjDgmFpOvSoCfqv375WImbJuVQPsx7c2u9lCN5qm2PtwGyGKYxRtsst20GQzJye3MTMP71g5+b+AubJJk0yOtIxjrxYrUkfWPzFismrNrg4EfTvFNe27plQgce6+uVI5vmemJFptNQ9833r5mrW7cMdJhUpuiVKltnl1g9jEtjjLZZbttkI5lX//nvJ3om5sgEHw/7yo9fmkj2c98904jA2g4GOL9F3S5zKwe3mtFOX+xW1/amDlucfsp2qbQ6ohC9UuXq0lxbqqu2tthg+eV2tMvc/9lI5sw7L09EBPLCzKYd8ew/nJ5ItjwI2lR2m3ze0coZidtGwvaPyB1xzGrmXjrwy357Ss+ysTWkt5VSZzJh3qZyxrW9slqRM6Fgeynl8FPxur46IqpLq5NdVw59BXvKqghnWraf3tk057d8H2obar15TfIgBuoxkI1knvjq0YmIQN4O0LSzvvydtcayL/72dfPZJx9tLLupDrF8cFwVhyXOGFtMilSkvCYdEAMct0srVg32YL86yxfnGiOZkqyKsxPoJCsE1KFXC1pOrE2Ic/p4HeQ8A7oij3b4yK9JFvnCUOs4SZrk1XXqsnUydT5c2/bgRoriHAp20n2B/AzrHQvtQ/sAA9lIRiqY5E3LOUjm0u82zJFvPNMLwUh7Y45NxzlnFcyYQUCWSPwWjStXkIy6kwwdp2fpjjycXInH7FyHMhPXZWJyEBeG1gGHh/4TrmRAiKFs+R/aReepS5N8SZIJCF3LjF1rco7ZKVVPTBbj6GCJAY+BrCQjhn78laPm7E9eNl+7dcHIx8FSv4dPPtGYDORW5pQciX/1X14za99/0cj70/rsbE0oqFfHhQ5T/9dOTsq2IZmUQ485z1gcdJdQnGu4YrH6BcSn26nL27wBgYbpdQ68Lk3kpNJT8WHd+K/tb/tF3fBQVw/KM/ROhbagLTQGspOMrmzRr+FotVN2q4BilWFn1361UkkLHHGFZILtsrIebO/Y9KKOIK/YfG0rnhbKCftHk+BIWvBMkCYrW06d11S2ogIbaOc+WoecbXl7henyP0YmKZmuPcXqcPWYOaxuxxY5IGfYBecwulxMB8bRqRIDaQyQZDp8AhbO6eqW37LCeQxAKA4X21jXt66Vt+yGjtHJ8g5WnDjK2edVLqcfxnRO0R9a42xBdKiTAx0R6ryoW0LI0/XUtVOnhQ7b/XckiHoR1qUhT5RkEltlum70FdoFgoFc1x9xGyIPw7RjoW1oG2CAJNMhycCoDDnAiAFigBhwGCDJkGR6PbfiwKPzJQaWCwMkGZIMSYYYIAaIgWwYIMkQXNnAxRnrcs1Y2d/s7xgGSDIkGZIMMUAMEAPZMECSIbiygSs2q2EcZ7vEwHJhgCRDkiHJEAPEADGQDQMkGYIrG7g4Y12uGSv7m/0dwwBJhiRDkiEGiAFiIBsGSDIEVzZwxWY1jONslxhYLgyQZEgyJBligBggBrJhgCRDcGUDF2esyzVjZX+zv2MYIMmQZEgyxAAxQAxkwwBJhuDKBq7YrIZxnO0SA8uFAZIMSYYkQwwQA8RANgyQZAiubODijHW5Zqzsb/Z3DAMkGZIMSYYYIAaIgWwYIMkMHFz4giO+RhnOFNwXHONflgzzhv/1J5PDNP7nrJQYIAa6wABJpkOSASHgk74S6k8PT9NhkEmS4YCfBj8sQ9zMGgMkmQwkkyKEaTqbJEMnMQ1uWIa4GQoGSDIkGXN49VC2/dihAJ160OkSA7PBAEmmJ5JxZyfvmvOXrxlsp12/fKx07itHNs3192+VaVgN+ZXMurkaTZd4fybj6vFyKnWsVmXY7bx3NkkyHWKAjmw2jox2H67dSTIdOhgQAkjEOvGtdUskcP438d+Syrvm/JFDxpbb8s7eHsgXxAGZ+mynmu5JpiSyI25lgrJCWKgf5CWDcm3rlrlJkimJno5quI6KfTO/fUOSyUAy2pFjcMQJwJEM8hy+/G65kgGpaKJAPh3n5LqVjJCPJjhcy2omdidZLA51MJzfQc2+Y98NCQMkmQGQDLbKsLXl/hfEsXrMnH/nltHEVUcyqZVJjFBicUMCJ3WhsyQG5h8DJJkhkMwL1yrbVrKiCVcy2GaTQVdND7fLqoS0tgWycucxICsQVYqUOLjnf3CzD9mHQ8AASSYDyWCbyp7JvI9zF3HyfnvMOXmkudUKyl3fumauB2cyV7f8VhgISACkt8vs/8QNBDZNbafdFF0uV8ltCICkDnSMxMBiYYAk0yHJcHAs1uBgf7I/iYH2GCDJkGR4dxUxQAwQA9kwQJIhuLKBi7PA9rNA2pA2nHcMkGRIMiQZYoAYIAayYYAkQ3BlA9e8z8CoP1cRxEB7DJBkSDIkGWKAGCAGsmGAJENwZQMXZ4HtZ4G0IW047xggyZBkSDLEADFADGTDAEmG4MoGrnmfgVF/riKIgfYYIMmQZEgyxAAxQAxkwwBJhuDKBi7OAtvPAmlD2nDeMUCSIcmQZIgBYoAYyIYBkgzBlQ1c8z4Do/5cRRAD7TFAkiHJkGSIAWKAGMiGAZIMwZUNXJwFtp8F0oa04bxjgCRDkiHJEAPEADGQDQMkGYIrG7jmfQZG/bmKIAbaY4AkQ5IhyRADxAAxkA0DJBmCKxu4OAtsPwukDWnDeccASYYkQ5IhBogBYiAbBkgyBFc2cM37DIz6cxVBDLTHAEmGJEOSIQaIAWIgGwZIMgRXNnBxFth+Fkgb0obzjgGSDEmGJEMMEAPEQDYMkGQIrmzgmvcZGPXnKoIYaI8BkgxJhiRDDBADxEA2DJBkCK5s4OIssP0skDakDecdAyQZkgxJhhggBoiBbBggyRBc2cA17zMw6s9VBDHQHgMkGZIMSYYYIAaIgWwYIMkQXNnAxVlg+1kgbUgbzjsGSDIkGZIMMUAMEAPZMECSIbiygWveZ2DUn6sIYqA9BkgyJBmSDDFADBAD2TBAkiG4soGLs8D2s0DakDacdwyQZEgyJBligBggBrJhgCRDcGUD17zPwKg/VxHEQHsMkGRIMiQZYoAYIAayYYAkQ3BlAxdnge1ngbQhbTjvGOiFZFZWr5jdewdme+3QoBxaV3qtrJ412/sfmd3NYbUvBc6Vzdvm7v4Nc3K1e31hiz/9+S9zY4+kndZumDsFbh1WbpuNKWyW094p3aeJb9PGSevTOPm3t3/aiZ0n1YH5+yHwTknGgfQjIw5GO5munHnXoOhKLwwYkswD5uTOgbm7d2VQk4lpcbPSI8kMgYj6JBmNk67sPG0/s1xesumMZEAwcLTO8bqZX1fOvC0YQjLoSq9QblM9py3XVH4qX06HtrH3kbmzc3YhSEbbr40DbmLvJnm0Pjmu27RxUn1SOOlTh0l1Zv7pyKg7kpFZX2ILpitn3raTQ6felV6h3KZ6TluuqfxUvpwOLeU8UrrMS3wb59fE3k3y5LZVmzZOqlsKJ33qMKnOzD9rkrHnLvFzidKZ79wut9L0lopL99tsd+/5vW8NRuQrV0vqbEGW39im0+UBDJQt8+zfMCfuK86KGuqVmqF7shB5vh2iJ9J0WXEo//s/t82vVV6ckYR6VsoVNkYbkBaWCdsfpkt51Cf2CdMhF7bTYZhX1yV9Bd10fKW83YLy+dCXOg+uw7qgVxiv63JpB2Z7U85TXD22HzY99rwcnKWN9pvo4LZx9Grc4zLUATJtuaCfQnujfToMScbVXbVTDEt226mY3MXK6Dr0dUx/F6faWNNXqfGWitd1hzh5/Xk5k5nczlomr6cjgD7s1tlKRpSVgWIHlCIJG18MOhDL6B5sdYvFDrhChh1ExR6/xN/ZPyi3Y0BA2hnUGQ2DFI4NAy2tl79ZISyr60FaxdkJAWLgKDKUcqK3JqCqPvE6oat2Ztq2Ol7bD+VQB+oHybj0eJ26jU3qgmyti5Zh7bTnbzjQeup8qbpS8VoO2lu2D5gEhqzjhENzJIN+svJ1v1XyChGhXDE5KW5kQf+7PnWElbJ32E78t20AWciNJAk7jeQrbjjpzrZoY40Oyi7Q39ouEa/z4BpjNyzn+g86pO0MOQyHSy7om05JBkIxmymdtyWZ0JG5/3rQoHxl0CrgbuxJmStm1w5GcRCFDJDYmDvYtFypK+5gvV6Ylesw5kBDuU42ZsmymvGDpTqIfB5bRs22wzpjdkIZOFT5P1J3QHBhGZGr68J1tJ0xWcGdddp5QJ8wBD6kLu3gdb6p26tsbdta839svynsVfqtxmYxvWNxuq1Wz4htY3aqYEnpB3mxMkhDmNJHtxF5Y/Jcvo/M3WC8peIhS4caJ3qSqHUQPYFHHcawqWXzeljEk4VkpJMBOD+7c87bpSmCiAwuN/hBIMgbkItshwRnQHAaIfgBOqRjlul0bK4X5IRhKNe30W8fymCVwSGhJ99RkgkJA3UlHcM4+8XSVVxKLurVYSyv7ivJq52HLivX2M6Bk9DOZSSv0lGnjdNhtE89wVsdFOmM6zetX+j8JumnmM66TXJdwYUlD7+613pIXtgYmLLtGlNG15fSp9LGBvJgv3C8peK1DmiD112vXorrBAa0HF4Pi1Bi/dEZydiBoG5d1YNdX1tQ2dkvSMRtL8Dx2PQAXHYw7XvnjP8oI3VvF8+oAOAgEt3oMK2JXlrOxp4Dv5bp2/NRSR4SZ52G2ja09tm/bXaL1ZcuhzqcPp6YJA/qDNPk//bO2ZLMYQsrV9lvtJwjNjjJMF3XKdf6h7ypulxZ7xx1WbkOnVtoI50fdWnbNG+vnjiMJxmQvtSvddLO3emjHWHTfqraW7cR18Al7DrOTlEsqT4P24F6ENbbNu7gQ7vExlvTcSh6NCIZOyFI2NmSoO9ntI1hdcwOwR6dkYw0RoCol7XaQeiHMd2g8gAB6FE23EJxg92Dzf335aVuAW1ZXpFdaGToKE62PPiv7K17uagXctGeUCacxO6eX96HbYCOcO6QofWRhyPr6tRpWv5Y+6ltBzvr3Kk+jKnlSltT7RSdx9WlnQfaiBB2gj3v7N0uD3yRR4dar6btdfqpPlQrF5Gt06FPqt9c/ZpY/CRD6xbaTEgCbYzZW7cRuNVEB70gI7QT0icpo+u0dihWKlIHbOtsg/Y6ckzpAL1teTXeUvFh/Ron09jZlfH9HMrn/+GQTackw46t71g9sGirelv1YR846zpS7UMP1jF7LLAP8vUBSSbYEsoFNj1by1UH5U42UEgyk9mL+KK9psEASaYHksEWAmfMwxqkJJlh9cc0Doxlht+HJJkeSIYDYfgDgX3EPiIG8mCAJEOSqdxBxoGWZ6DRrrTrsmKAJEOSIckQA8QAMZANAyQZgisbuJZ15sZ2c9VCDHgMzBXJ9HlvvH6eog1g5u1wOXwQsE3bJymrn9GYpFyfefvUEbiR51CG9lGvWWGk675eWT1qPnj7TfPx2+vm6hQfo2uqz9VLb5qP3zplTk9Yx8rhU+ZD0W+Ksk116yNfZySDO6jw8BZC/cBY2waRZPzsoK0tU+Vn5UD6dOCpto+L71NH+4R95aWe7sHDPnVI2WNWGEnpE8avrB427731pvm/73/bfHCi+vXXlRPrNv7jS0fNUEgGZCL6yu/jty+Y9w4fMognyQTbTUMYBCHomvzHzBG3Gbt2tH+iOJTbRBfJM225pvJT+WblQNripg97tdUxZfNYfOrB3T51iOklcbPCSEqfWLwmE50uq4oY+eg8XV/XrWRAJCAYkkxAKLHOGMIgiOk1Li50Uq4dJJlxdusqvS1uwv7rSi8tp62OWta4a5JMu1V7bJUSxoX/pU8QB6f/4frhMk6vKEKyskSS2HarJRm1sgImTq+vj65kinyil+iEvKG+2PpD/LQ6Q34XYWfbZVAmNRBdvHq/mHp5JMpKCGeBlwVKnN06kHeNqY8bubzu5ZrYmkMZPUBRb7lCCV4kGJNTea8ZP2hW+RAbbCx2q/vhnWzSN3g3VszWkBfiBv0W9m1Mxh9/8qOKjuH74aCn2271GAQmkK7DWP0jOqr3f4meWl6q/al4XbfeehbbdfVRr1T7XbsOzLbCOvpF9AptYfs0eAO61j/MX+1/vHm8Ona17cLy0GWcnloHuQ6JIFzdlI64IAf8B8EglC03RyLFNlZxlgOHj+057dC1Lo1Iptgi0+Wwyvn4rQv2bAb6hESCeIRIb6Oz1qPtdS8kA9AALKK0XXKniEYRAUhHQOgGCV7gF75dF+A95EgJ+9mJD52FhtP1WP2KN8DiTEmfB5Vgr7xY07/AU8uG3MpAk/bhA1iqrVJOHIxta/Cdlro6Y/bVbUjZHeX0AJf64aTr6tRtDK91P+m0OnkubXzfQmfdJtdW3/+6Tlzbfkh8CAx5EKbrEMxBx/n6qFdd+9HeNNar2NYYgc0QQpbuHz3Wx46HkRea+n6F7JieqF+HIamMkE5w8B/mh5OXlcPp9QvlNpuLv2A+fOtNo8929ApD61FLMur8CCSBcyTUX57RlPoWZIdVkLoxAG1sq7PWv+11PyQTOFJRGmDTDg6NcWAqDjrtbLEY2PpavekWs10JBdzayaU+dIa6EIb6aB28voVONXVDHsJQrpcFMvFk6epUTqz46qEtU1Nnao88Fq/1iaarvpJ0bVtcaweCduqwdAbhR61q5FXaXpdP6Vet0zsjHR9eN1lJxOwicrSOkBuTl2w/Ji6BXSBLh+LIYWeNZ63DNP2T1tdvDTuMeKxj0gH9UvaR9FhaBXPB5MmWUXF1bXJtj+sJ3XSIlYmb2Rd3kimHXE0/VBIJnD1CSyTFnV7ivIWMZNXyHu4as2nO8ev6cV1HMjoP6pNQiKYkGaWzlVWsekB8mtx0HMpPozP06iKcMcl4wISNwSCTQREdbAlnI3L8IBn/oTPUqweCk+Gdf1XmoehAgpwwDOV6WX52iDZKWM7S1MCzZeram0hLD/hmDiRWPmxf3X+0HR+1qpMXOs/QsaGelAzUFXRjftAAAAaDSURBVJu0WPsVW1sxLEE2wnQdaiXTQB50QvtL+UXfhvFIlxD4l+s6kknZScvyMuqIy49Fp3czjIzUE8FiRV6Aa6ubikvZ3uVLj8lQD/zHzP6DS+6uMu2QUySj80CO3hITcikdtzj89fXa26DrSEYICysX28ZidWLlR25h1iQTrrykfNleIalilQRCnERntLuLsB+SKWZwGODWmBEw6gbZgRV+5EuvZAqZ2qngA18ixzrumg+d6bqsPgro7n8a0JippurWsktHo765YclEbRVG2xrVxxOT1IH2hvrI/+Yf+PIyS13Lb82LDXy6rlO3MbyW9kQ/alXTZxWSGZvP6+TbWr+SCZ1X2Ae6DfX2LFaaAX61vGT7E3bRdeO6EcnU2AlyENa137U3QTJBHSFGIB8hbJca62X5xHhA+djYqtMT9YchZvOyOsC2E/KEJIP/ekWB8w0pI6sEkSHbZHql8eFbF+y2GeSG4TiS0fXhWsvXZz0VklFnQygnYRc6h21o878XkhEFAR5sueBMIqV8DIzWGYfO+V78INflVc7IEpQfSLF6xVGIfjI75AfN3PMFsCP6DYM/7IvQnuIkUQarM4uDYgWAtFKedWbOgdflC9M0jnT/yQfgtE7AE+oNPwSm86bqcBiubmem5KXan4oP629CMqGeogvsGcqra/845y0EhXaO+wib1akgJl9G9SsmTzUf+Etizsr1Y9i1yf8P2+x08c/MaGft0kYfxtSkFDpspMGJY6Ug+fRqJNSjlmSK1YomCcgq60tsl+k2oDx0gw6ljPLmBm8P1IO8ucLOSSaXoosuVzuVeWirnRmr2eg86Ewd6+8I7MM+ILsUGfahQ9911JFM37rMoj6SzJhbcfvolHGrgj50mLQOWTUsk6OY1D7MHyc0kkzcLouMF5LMjEkG2yd02Ms3+BbZsaTaRpJZPpyTZGZMMqnByPjlG4zsc/b5ImKAJEOSqRyQLyLI2SY6b2JgdhggyZBkSDLEADFADGTDAEmG4MoGLs4eZzd7pO1p+6FgYOlJRj/cNJROoR50EMQAMbAoGOiMZGJPy9qHmS4dbTRTxtO08rGePo1LkuFg7hNvrIt4WzYMZCeZcU/DwuCzcvazqhftZkinQwwQA4uMgc5JRr/WAA7851/4gv0cqn53EF7JIHH//Yb7Wl35aoRi9ROujvSL68I0eVOqdNRIfPAhIbxmAass6IgVVFhe17nIQGDb6OiIAWIgBwY6JxkQhXXi6kM8+hXU0hA4eyEHcfSVcur72zperu2L4yIvhtPfdQjLgPhCAkE+kF8qva93/OToYMqk4yAGiIFZYiAryYgTLx148NpqkA4c+MiKAh/kwQqlKI/XVVvZwXlP+err4IVykrdSrkgHqZQ61tQ5y05i3XQSxAAxMK8Y6JxksGoQg5ROvyADRyTr5iq+c6C2skKSAQlhtYFQVixIA0HB+IjXW1w6Tl9b/Uo93AeHkI66EGIrDvUw5IAnBogBYqAZBrKSDJw2nDRI54P1U/ab1YiXzkqRjCYMdGooF/GQH8oVshBCCsuFKxmkx+pEHQybAYt2op2IAWJAMNA5yWD2r0M4bTh1+5EfdV4jigjJoIyQBPIiTkKskqJpiTKVcpFvN7j04pvZsbMefIehwfdoOKg4qIgBYoAYqGIgO8mAYGB4kMnIB4QUAWAlgpsDQDQgGZE1koazm4AodBlbrjh3EZkfrh8dvetN6VEhKJJMr88vAS8MqwOW9qA95g0DnZFM04ZzS4qDpClWmI9YIQbmHwO9kox+NgbPpRBE8w8i9iH7kBggBlIY6I1ksE1mt6CCW49TyjGewCUGiAFiYL4x0DvJhGcxBNB8A4j9x/4jBoiBOgz0RjJ1SjCNICUGiAFiYDExQJLh92R41xgxQAwQA9kwQJIhuLKBizPTxZyZsl/Zr5NggCRDkiHJEAPEADGQDQMkGYIrG7gmme0wL2fHxMBiYoAkQ5IhyRADxAAxkA0DJBmCKxu4ODNdzJkp+5X9OgkGSDIkGZIMMUAMEAPZMECSIbiygWuS2Q7zcnZMDCwmBkgyJBmSDDFADBAD2TBAkiG4soGLM9PFnJmyX9mvk2CAJEOSIckQA8QAMZANAyQZgisbuCaZ7TAvZ8fEwGJigCRDkiHJEAPEADGQDQMkGYIrG7g4M13MmSn7lf06CQZIMiQZkgwxQAwQA9kwQJIhuLKBa5LZDvNydkwMLCYG/h/nm5XEAD5e2wAAAABJRU5ErkJggg==" alt="Bytecode Viewer"></p> <p>安装完这个插件，在顶部菜单栏的 View 中将会多出一个 Show Bytecode 按钮选项，我们可以在对应的 <code>.java</code> 文件中点击 View -&gt; Show Bytecode，展示出该文件的 Byte Code。</p> <p><img src="/blog/assets/img/view-show-bytecode.6c53c525.png" alt="View -&gt; Show Bytecode"></p> <p><img src="/blog/assets/img/idea-bytecode-show.d0ed41ec.png" alt=""></p> <p>在这里所展示的 Byte Code 格式与我们上面使用 <code>javap</code> 显示出来的不一样。首先在这里我们看不到常量池，因此在指令里也不会用引用的方式来表示常量池的内容。</p> <p>在这里它会将每一行 Java 代码的指令都区分开。例如 main 方法中的第一行指令对应的就是 L0 那一块，第一行的 LINENUMBER 对应上面 <code>javap</code> 中的 LineNumberTable，直接在这里描述当前 L0 这一块的指令对应的代码在文件中的位置。也因此我们不会在生成的这个 Byte Code 里面看到 LineNumberTable，因为它直接分布在各个指令块中了。</p> <p><img src="/blog/assets/img/main-l5.55303a5b.png" alt="main 方法中的 L5"></p> <p>在方法的最后，会多出一块内容来描述方法的信息，在这里会将 LocalVariableTable 里的变量都列出来，但格式与 javap 的 LocalVariableTable 中的描述格式不一样，每一行 LOCALVARIABLE 代表一个变量，描述格式从左到右依次为变量名、类型、开始可见时的指令块、最后有效的位置、Solt。除了描述方法中出现的变量外，操作数栈最大深度和本地变量个数也在放在这里。</p> <p>由于该插件主要是为了阅读 Byte Code 中的指令，因此是以一种更加方便阅读指令的方式展示 Byte Code，例如对指令根据源码做分块，并把对应代码行数放在指令块的第一行，这样我们就不需要去对照 LineNumberTable 寻找当前指令的代码所在的位置了，反过来由于进行了分块查询对应代码的指令也很方便。但这个插件显示的内容也少了很多东西，如果需要查看初始常量池的内容，那就需要使用 <code>javap</code> 了。</p> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <blockquote><p>字节码增强技术探索：https://tech.meituan.com/2019/09/05/java-bytecode-enhancement.html
一文看懂 JVM 内存布局及 GC 原理：https://www.infoq.cn/article/3wyretkqrhivtw4frmr3
Oracle 官方说明文档：https://docs.oracle.com/javase/specs/jvms/se16/html/jvms-4.html#jvms-4.10
Oracle 官方指令文档：https://docs.oracle.com/javase/specs/jvms/se16/html/jvms-6.html</p></blockquote></div></div> <footer class="page-edit" data-v-53526f68><!----> <!----></footer> <!---->  <footer id="footer" data-v-53526f68><div class="content" data-v-53526f68><div data-v-53526f68>© Copyright <strong data-v-53526f68>Kori Lin</strong></div> <div data-v-53526f68>
                Powered by
                <a href="https://vuepress.vuejs.org/" data-v-53526f68>Vuepress</a></div> <div data-v-53526f68>
                备案号：<a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/" data-v-882df4f6 data-v-53526f68>
                    粤ICP备19149652号
                </a></div></div></footer></main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.a56c6be2.js" defer></script><script src="/blog/assets/js/2.c104596a.js" defer></script><script src="/blog/assets/js/4.955ca39c.js" defer></script><script src="/blog/assets/js/3.b9b417ac.js" defer></script>
  </body>
</html>
